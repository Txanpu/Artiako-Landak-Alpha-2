<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Artiako Landak – v13</title>
<style>
:root{
  --bg:#0d1117; --panel:#161b22; --tile:#0f172a; --border:#30363d; --txt:#e6edf3;
  --tileW:5.4%;
  --tileH:8%;
}
*{box-sizing:border-box}
body{
  margin:0; background:var(--bg); color:var(--txt); font-family:system-ui,sans-serif;
  display:grid; grid-template-columns:minmax(520px,1fr) 380px; gap:12px; padding:12px; min-height:100vh;
}
.boardWrap{
  overflow: visible; /* antes auto */
  overflow-x: hidden;
}

#board{
  position: relative;
  width: 100%;
}

@media (max-width:900px){
  .boardWrap{
    max-width: 100%;
    /* quito height para que crezca con el contenido */
  }
}

/* panel que siga el scroll */
.panel{
  position: sticky;
  top: 12px;
  align-self: start;
  height: fit-content;
}

/* letra un poco más pequeña para que respiren */
.tile .name{ font-weight:800; font-size:clamp(.6rem,.7vw,.9rem); }
.tile .meta{ font-size:clamp(.56rem,.65vw,.8rem); }
.tile .badge{ font-size:.58rem; }

/* Casilla tipo v11 */
.tile{
  position:absolute;
  width:var(--tileW); height:var(--tileH);
  background:linear-gradient(180deg,#111827,#0b1220);
  border:2px solid #475569; border-radius:10px;
  display:grid; grid-template-rows:auto 1fr auto; gap:4px;
  padding:6px; transition:transform .12s,box-shadow .12s;
}
.tile:hover{ transform:translateY(-3px); box-shadow:0 0 8px rgba(255,255,255,.15); }
.tile .band{ height:8px; border-radius:6px; box-shadow:inset 0 -1px 0 rgba(0,0,0,.35); }
.tile .head{ display:flex; justify-content:center; align-items:center; gap:6px; }
.tile .name{ font-weight:800; font-size:clamp(.7rem,.8vw,.95rem); text-align:center; line-height:1.05; }
.tile .internal-id{ font-size:.65rem; opacity:.85; background:rgba(0,0,0,.35); padding:2px 6px; border-radius:999px; position:absolute; top:4px; right:4px; }
.tile .meta{ display:flex; justify-content:space-between; font-size:clamp(.62rem,.7vw,.85rem); opacity:.95; }
.tile .meta .left{ max-width:60%; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.tile .badges{ display:flex; gap:4px; align-items:center; justify-content:center; }
.tile .badge{ font-size:.65rem; border:1px solid #64748b; border-radius:6px; padding:1px 6px; background:#0b1220 }

/* Fichas */
.chips{ position:absolute; left:6px; bottom:6px; display:flex; gap:3px; }
.chip{ width:18px; height:18px; border-radius:50%; border:2px solid #fff; display:flex; align-items:center; justify-content:center; font-size:.7rem; font-weight:900; color:#fff; filter:drop-shadow(0 1px 4px rgba(255,255,255,.25)); }
.chip.p0{background:#ef4444}.chip.p1{background:#22c55e}.chip.p2{background:#3b82f6}.chip.p3{background:#f59e0b}.chip.p4{background:#a855f7}.chip.p5{background:#14b8a6}

/* Panel lateral */
.panel{ background:var(--panel); border-radius:16px; padding:12px; display:flex; flex-direction:column; gap:10px; }
.players{ display:flex; gap:6px; flex-wrap:wrap; }
.badge{ padding:6px 10px; border-radius:999px; border:1px solid var(--border); font-size:.92rem; }
.badge.active{ outline:2px solid #22c55e; }
button{ background:#21262d; border:1px solid #30363d; color:var(--txt); padding:10px; border-radius:10px; font-weight:800; cursor:pointer; }
button.primary{ background:#22c55e; border-color:#15803d; color:#052e16; }
.row{ display:flex; gap:8px; flex-wrap:wrap; }
.log{ background:#0d1117; border:1px solid #30363d; border-radius:12px; padding:8px; height:240px; overflow:auto; font-family:ui-monospace,monospace; font-size:.9rem; }
.auction{ border:1px dashed #f59e0b; padding:8px; border-radius:10px; }
.hint{ font-size:.85rem; opacity:.85; }

/* Modal carta */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:20}
.card{width:320px;background:#111827;border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.5);overflow:hidden}
.card .top{height:54px; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:900; font-size:1rem; letter-spacing:.2px; text-shadow:0 1px 2px rgba(0,0,0,.35);}
.card .body{padding:12px}
.card .title{font-size:1.15rem;font-weight:900;margin-bottom:6px}
.muted{opacity:.85}
#cardRentsBox{ margin-top:10px }
#cardRentsBox table{ width:100%; border-collapse:collapse; }
#cardRentsBox th, #cardRentsBox td{ padding:.35rem .5rem; border-bottom:1px solid rgba(255,255,255,.12); text-align:left; }
#cardRentsBox td:last-child{ text-align:right; }
#bankWarn{ margin-top:.4rem; font-size:.85rem; opacity:.95 }
#bankWarn.bad{ color:#ef4444 }

/* Dados */
.diceWrap{display:flex;gap:12px;align-items:center;min-height:88px}
.die{width:70px;height:70px;border-radius:12px;background:#fafafa;border:3px solid #111;display:grid;grid-template-rows:repeat(3,1fr);grid-template-columns:repeat(3,1fr);padding:8px;box-shadow:0 6px 18px rgba(0,0,0,.35)}
.pip{width:12px;height:12px;background:#111;border-radius:50%;align-self:center;justify-self:center}
.diceMeta{font-size:.95rem;opacity:.9}
.shaker{animation:shake .35s ease}
@keyframes shake{
  0%{transform:translate(0,0) rotate(0deg)}
  25%{transform:translate(-3px,2px) rotate(-6deg)}
  50%{transform:translate(3px,-2px) rotate(6deg)}
  75%{transform:translate(-2px,3px) rotate(-4deg)}
  100%{transform:translate(0,0) rotate(0deg)}
}
</style>
</head>
<body>
  <div class="boardWrap">
    <div class="board" id="board"></div>
  </div>

  <div class="panel">
    <h2>Artiako Landak</h2>
    <div class="setup">
      <label>Jugadores: <input id="numPlayers" type="number" min="2" max="6" value="3"></label>
      <label>Dinero inicial: <input id="startMoney" type="number" min="100" step="50" value="500"></label>
      <button id="newGame" class="primary">Nueva partida</button>
    </div>
    <div id="dice" class="diceWrap" aria-live="polite" aria-label="Resultado de los dados"></div>
    <div class="players" id="players"></div>
    <div class="row">
      <button id="roll" class="primary">Tirar dados</button>
      <button id="endTurn">Terminar turno</button>
      <button id="loan">Prestar dinero</button>
      <button id="build">Construir</button>
      <button id="sell">Vender casa</button>
      <button id="mortgage">Hipotecar</button>
      <button id="unmortgage">Levant. hipoteca</button>
    </div>
    <div id="auction" class="auction" style="display:none"></div>
    <div class="hint">Todo va por subasta. Impuesto: 3% de tus <i>ganancias</i> desde tu último impuesto. Construir paga al Estado. Si el Estado elimina a alguien, todos pierden.</div>
    <div class="log" id="log"></div>
  </div>

  <!-- Modal carta propiedad -->
  <div class="overlay" id="overlay">
    <div class="card" id="propCard">
      <div class="top" id="cardBand"></div>
      <div class="body">
        <div class="title" id="cardName"></div>
        <div class="row" style="justify-content:space-between"><span class="muted">Precio</span><strong id="cardPrice"></strong></div>
        <div class="row" style="justify-content:space-between"><span class="muted">Alquiler base</span><strong id="cardRent"></strong></div>
        <div class="row" style="justify-content:space-between"><span class="muted">Rendimiento</span><strong id="cardRoi"></strong></div>
        <div id="cardRentsBox"></div>
        <div id="bankWarn" class="muted"></div>
        <div class="row" style="margin-top:10px">
          <button id="startAuction" class="primary">Iniciar subasta</button>
          <button id="cancelAuction">Cancelar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="doubleOverlay" id="doubleOverlay" aria-hidden="true" style="display:none"></div>

  <!-- JS: todas las partes en orden -->
 <script src="v13-part3.js"></script>
<script src="v13-part2.js"></script>
<script src="v13-part4.js"></script>
<script src="v13-part5.js"></script>
<script src="v13-part6.js"></script>
<script src="v13-part7.js"></script>
</body>
</html>
